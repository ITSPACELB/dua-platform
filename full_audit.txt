=== COMPLETE PROJECT AUDIT ===

=== ALL API ROUTES ===

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\auth\check-unique\route.js ---
// POST endpoint
// Body: {fullName, motherName, uniqueQuestion?, questionAnswer?}

// Logic:
// 1. Query DB: SELECT * FROM users WHERE full_name=$1 AND mother_name=$2
// 2. If count === 0 โ return {unique: true}
// 3. If count === 1 && no question โ return {unique: true, userId}
// 4. If count > 1 && no question โ return {unique: false, suggestedQuestion: 'father'}
// 5. If question provided โ verify answer โ return {unique: true/false, userId}

// Response: {unique: boolean, userId?: number, suggestedQuestion?: string}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\auth\check-uniqueness\route.js ---
import { NextResponse } from 'next/server';

export async function POST(request) {
  try {
    const { fullName, motherName } = await request.json();
    
    // TODO: Check database for uniqueness
    // For now, always return true
    return NextResponse.json({
      isUnique: true,
      message: 'ุงูุงุณู ูุชุงุญ'
    });
  } catch (error) {
    return NextResponse.json(
      { error: 'ุฎุทุฃ ูู ุงูุฎุงุฏู' },
      { status: 500 }
    );
  }
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\auth\login\route.js ---
import { NextResponse } from 'next/server';
import { query } from '@/lib/db';
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';

export async function POST(request) {
  try {
    const { fullName, motherName } = await request.json();

    // ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุทููุจุฉ
    if (!fullName || !motherName) {
      return NextResponse.json(
        { error: 'ุงูุงุณู ุงููุงูู ูุงุณู ุงูุฃู ูุทููุจุงู' },
        { status: 400 }
      );
    }

    // ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู
    const result = await query(
      `SELECT id, full_name, mother_name, city, show_full_name, email, created_at 
       FROM users 
       WHERE full_name = $1 AND mother_name = $2`,
      [fullName, motherName]
    );

    if (result.rows.length === 0) {
      return NextResponse.json(
        { error: 'ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ. ุงูุฑุฌุงุก ุงูุชุณุฌูู ุฃููุงู.' },
        { status: 404 }
      );
    }

    const user = result.rows[0];

    // ุชุญุฏูุซ ุขุฎุฑ ุชุณุฌูู ุฏุฎูู
    await query(
      'UPDATE users SET last_login = NOW() WHERE id = $1',
      [user.id]
    );

    // ุฅูุดุงุก JWT token
    const token = jwt.sign(
      { 
        userId: user.id, 
        fullName: user.full_name,
        motherName: user.mother_name 
      },
      JWT_SECRET,
      { expiresIn: '30d' }
    );

    // ุฅูุดุงุก displayName
    const displayName = user.show_full_name
      ? `${user.full_name}${user.city ? ` (${user.city})` : ''}`
      : `${user.full_name.split(' ')[0]}...`;

    return NextResponse.json({
      success: true,
      user: {
        id: user.id,
        fullName: user.full_name,
        motherName: user.mother_name,
        city: user.city,
        displayName,
        email: user.email,
        showFullName: user.show_full_name,
        createdAt: user.created_at
      },
      token
    });

  } catch (error) {
    console.error('Login error:', error);
    return NextResponse.json(
      { error: 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุณุฌูู ุงูุฏุฎูู' },
      { status: 500 }
    );
  }
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\auth\register\route.js ---
import { NextResponse } from 'next/server';
import { query } from '@/lib/db';
import bcrypt from 'bcrypt';
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';

export async function POST(request) {
  try {
    const { 
      fullName, 
      motherName, 
      nickname, 
      city, 
      showFullName, 
      email,
      uniqueQuestion,
      questionAnswer 
    } = await request.json();

    // ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุทููุจุฉ
    if (!fullName || !motherName) {
      return NextResponse.json(
        { error: 'ุงูุงุณู ุงููุงูู ูุงุณู ุงูุฃู ูุทููุจุงู' },
        { status: 400 }
      );
    }

    // 1. Check uniqueness (internal check)
    const existingUsers = await query(
      'SELECT id, unique_question FROM users WHERE full_name = $1 AND mother_name = $2',
      [fullName, motherName]
    );

    const isUnique = existingUsers.rows.length === 0;

    // 2. If not unique && no question โ return 409 with available questions
    if (!isUnique && !uniqueQuestion) {
      // Get available questions from existing users
      const availableQuestions = existingUsers.rows
        .map(u => u.unique_question)
        .filter(q => q); // Filter out null questions

      return NextResponse.json(
        { 
          error: 'ุงููุณุชุฎุฏู ููุฌูุฏ ุจุงููุนู. ูุฑุฌู ุงุฎุชูุงุฑ ุณุคุงู ุชูููุฒ.',
          requiresQuestion: true,
          availableQuestions: availableQuestions.length > 0 ? availableQuestions : undefined
        },
        { status: 409 }
      );
    }

    // If question provided, validate uniqueness of the combination
    if (uniqueQuestion && !isUnique) {
      // Check if same question already exists for this name combination
      const duplicateQuestion = await query(
        'SELECT id FROM users WHERE full_name = $1 AND mother_name = $2 AND unique_question = $3',
        [fullName, motherName, uniqueQuestion]
      );

      if (duplicateQuestion.rows.length > 0) {
        return NextResponse.json(
          { 
            error: 'ูุฐุง ุงูุณุคุงู ูุณุชุฎุฏู ุจุงููุนู. ูุฑุฌู ุงุฎุชูุงุฑ ุณุคุงู ุขุฎุฑ.',
            requiresQuestion: true
          },
          { status: 409 }
        );
      }
    }

    // 3. Hash question_answer with bcrypt (if provided)
    let questionAnswerHash = null;
    if (questionAnswer) {
      questionAnswerHash = await bcrypt.hash(questionAnswer.trim().toLowerCase(), 10);
    }

    // 4. INSERT INTO users
    const result = await query(
      `INSERT INTO users (
        full_name, 
        mother_name, 
        nickname, 
        unique_question, 
        question_answer_hash, 
        city, 
        show_full_name, 
        email, 
        created_at, 
        last_login
      )
       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())
       RETURNING id, full_name, mother_name, nickname, city, show_full_name, email, unique_question, created_at`,
      [
        fullName, 
        motherName, 
        nickname || null,
        uniqueQuestion || null,
        questionAnswerHash,
        city || null, 
        showFullName !== false, 
        email || null
      ]
    );

    const user = result.rows[0];

    // ุฅูุดุงุก ุณุฌู ุฅุญุตุงุฆูุงุช ูููุณุชุฎุฏู
    await query(
      `INSERT INTO user_stats (user_id, total_prayers_given, total_notifications_received, interaction_rate)
       VALUES ($1, 0, 0, 0)`,
      [user.id]
    );

    // 5. Generate JWT (30 days)
    const token = jwt.sign(
      { 
        userId: user.id, 
        fullName: user.full_name,
        motherName: user.mother_name,
        nickname: user.nickname
      },
      JWT_SECRET,
      { expiresIn: '30d' }
    );

    // ุฅูุดุงุก displayName
    const displayName = user.nickname 
      ? user.nickname
      : user.show_full_name
        ? `${user.full_name}${user.city ? ` (${user.city})` : ''}`
        : `${user.full_name.split(' ')[0]}...`;

    // 6. Return {user, token}
    return NextResponse.json({
      success: true,
      user: {
        id: user.id,
        fullName: user.full_name,
        motherName: user.mother_name,
        nickname: user.nickname,
        city: user.city,
        displayName,
        email: user.email,
        showFullName: user.show_full_name,
        uniqueQuestion: user.unique_question,
        createdAt: user.created_at
      },
      token
    });

  } catch (error) {
    console.error('Registration error:', error);
    return NextResponse.json(
      { error: 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู' },
      { status: 500 }
    );
  }
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\prayer\collective\route.js ---
// POST endpoint - Collective prayer (95%+ only)
// Body: {message: optional}
// Headers: Authorization

// Logic:
// 1. Verify JWT โ get user
// 2. Check interactionRate >= 95% โ else return 403
// 3. Check last collective prayer (1 per week)
//    SELECT created_at FROM collective_prayers WHERE user_id=$1 ORDER BY created_at DESC LIMIT 1
// 4. If < 7 days โ return {error: 'wait', remainingTime}
// 5. INSERT INTO collective_prayers (user_id, message, created_at)
// 6. Send notification to ALL active users
// 7. Return {success: true, notificationsSent}

// Notification payload:
// {
//   title: "ุฏุนุงุก ุฌูุงุนู ูู [userName] ๐ข",
//   body: "ูุคูู ููุซู ูุฏุนู ููู ุงููุคูููู",
//   url: "/"
// }

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\prayer\private\route.js ---
// POST endpoint - Private prayer (98%+ only)
// Body: {targetUserId, message}
// Headers: Authorization

// Logic:
// 1. Verify JWT โ get user
// 2. Check interactionRate >= 98% โ else return 403
// 3. Check daily limit (5 private prayers per day)
// 4. INSERT INTO private_prayers (sender_id, receiver_id, message, created_at)
// 5. Send notification to target user
// 6. Return {success: true}

// Notification:
// {
//   title: "ุฏุนุงุก ุฎุงุต ูู [userName] ๐ก",
//   body: "[message]",
//   url: "/prayers/private"
// }

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\reactions\route.js ---
// POST endpoint - React to prayer (heart/angel/like)
// Body: {requestId, reactionType: 'heart'|'angel'|'like'}
// Headers: Authorization

// Logic:
// 1. Verify JWT โ get userId
// 2. Get prayer request owner
// 3. Check if already reacted (prevent duplicates)
// 4. INSERT INTO reactions (request_id, user_id, reactor_id, type, created_at)
// 5. Update reactor's stats (add points for gold calculation)
// 6. Notify request owner
// 7. Return {success: true, totalReactions}

// GET endpoint - Get reactions for request
// Query: ?requestId=X
// Return: {heart: 5, angel: 3, like: 10, topReactors: [{name, verificationLevel}]}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\reviews\route.js ---
// Integration with Google Reviews

// GET /api/reviews/stats
// Return current aggregate rating from DB or Google My Business API

// POST /api/reviews/request
// Body: {userId}
// Logic:
// 1. Check if user has 20+ prayers
// 2. Check if not requested review in last 30 days
// 3. Return {shouldAskReview: true, reviewUrl: 'https://g.page/r/...'}

// Table: review_requests
// CREATE TABLE review_requests (
//   id SERIAL PRIMARY KEY,
//   user_id INTEGER REFERENCES users(id),
//   requested_at TIMESTAMP DEFAULT NOW()
// )

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\send-notification\route.js ---
import { NextResponse } from 'next/server'
import webpush from 'web-push'

// ุฅุนุฏุงุฏ Web Push
webpush.setVapidDetails(
  'mailto:haydar.cd@gmail.com',
  process.env.NEXT_PUBLIC_VAPID_PUBLIC_KEY,
  process.env.VAPID_PRIVATE_KEY
)

export async function POST(request) {
  try {
    const { subscription, title, body } = await request.json()

    const payload = JSON.stringify({
      title: title || 'ููุตุฉ ุงูุฏุนุงุก ุงูุฌูุงุนู',
      body: body || 'ูุฏูู ุทูุจุงุช ุฏุนุงุก ุฌุฏูุฏุฉ',
      icon: '/icon-192.png',
      badge: '/icon-192.png',
      url: '/'
    })

    await webpush.sendNotification(subscription, payload)

    return NextResponse.json({ success: true })
  } catch (error) {
    console.error('Error sending notification:', error)
    return NextResponse.json(
      { error: 'Failed to send notification' },
      { status: 500 }
    )
  }
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\settings\banner\route.js ---
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({
    active: false,
    text: '',
    link: ''
  });
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\tracking\share\route.js ---
// POST /api/tracking/share - Track shares
// Headers: Authorization

// Logic:
// 1. Verify JWT โ get userId
// 2. Check if already shared today (prevent spam)
//    SELECT COUNT(*) FROM shares WHERE user_id=$1 AND created_at > CURRENT_DATE
// 3. If > 5 today โ return (ignore duplicate shares)
// 4. INSERT INTO shares (user_id, created_at)
// 5. Update user stats (shares count for gold verification)
// 6. Return {success: true}

// Table: shares
// CREATE TABLE shares (
//   id SERIAL PRIMARY KEY,
//   user_id INTEGER REFERENCES users(id),
//   created_at TIMESTAMP DEFAULT NOW()
// )

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\users\active\route.js ---
// GET endpoint - Get active users for private prayer
// Headers: Authorization

// Logic:
// 1. SELECT id, full_name, nickname, verification_level 
//    FROM users 
//    WHERE last_login > NOW() - INTERVAL '7 days'
//    AND id != $currentUserId
//    ORDER BY interaction_rate DESC
//    LIMIT 50

// Return: [{id, displayName, verificationLevel}]

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\users\stats\route.js ---
import { NextResponse } from 'next/server';
import { query } from '@/lib/db';
import jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';

// ุฏุงูุฉ ููุชุญูู ูู ุงูู token
function verifyToken(request) {
  const authHeader = request.headers.get('authorization');
  
  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return null;
  }

  const token = authHeader.substring(7);
  
  try {
    return jwt.verify(token, JWT_SECRET);
  } catch (error) {
    return null;
  }
}

// ุญุณุงุจ ูุนุฏู ุงูุชูุงุนู
function calculateInteractionRate(prayersGiven, notificationsReceived) {
  if (notificationsReceived === 0) return 0;
  return Math.round((prayersGiven / notificationsReceived) * 100);
}

// ุชุญุฏูุฏ ูุณุชูู ุงูุชูุซูู
function getVerificationLevel(interactionRate) {
  if (interactionRate >= 98) {
    return {
      name: 'GOLD',
      color: 'amber',
      icon: '๐',
      threshold: 98
    };
  } else if (interactionRate >= 90) {
    return {
      name: 'GREEN',
      color: 'emerald',
      icon: 'โโ',
      threshold: 90
    };
  } else if (interactionRate >= 80) {
    return {
      name: 'BLUE',
      color: 'blue',
      icon: 'โ',
      threshold: 80
    };
  } else {
    return {
      name: 'NONE',
      color: 'stone',
      icon: '',
      threshold: 0
    };
  }
}

// ุงูููุฒุงุช ุงูููุชูุญุฉ ุญุณุจ ุงููุณุชูู
function getUnlockedFeatures(interactionRate) {
  const features = [];
  
  if (interactionRate >= 80) {
    features.push('priority_display'); // ุธููุฑ ุฃูููู ูู ุงูููุงุฆู
    features.push('blue_badge'); // ุดุงุฑุฉ ุฒุฑูุงุก
  }
  
  if (interactionRate >= 90) {
    features.push('green_badge'); // ุดุงุฑุฉ ุฎุถุฑุงุก ูุฒุฏูุฌุฉ
    features.push('top_priority'); // ุฃููููุฉ ุนููุง
  }
  
  if (interactionRate >= 98) {
    features.push('gold_badge'); // ุดุงุฑุฉ ุฐูุจูุฉ
    features.push('max_priority'); // ุฃุนูู ุฃููููุฉ
    features.push('special_reactions'); // ุฑุฏูุฏ ุฎุงุตุฉ
  }
  
  return features;
}

// ุญุณุงุจ ุงููุณุชูู ุงููุงุฏู
function calculateNextLevel(rate) {
  if (rate < 80) {
    return {
      level: 'BLUE',
      levelName: 'ุงูุชูุซูู ุงูุฃุฒุฑู',
      remaining: 80 - rate,
      icon: 'โ',
      color: 'blue'
    };
  }
  if (rate < 90) {
    return {
      level: 'GREEN',
      levelName: 'ุงูุชูุซูู ุงูุฃุฎุถุฑ',
      remaining: 90 - rate,
      icon: 'โโ',
      color: 'emerald'
    };
  }
  if (rate < 98) {
    return {
      level: 'GOLD',
      levelName: 'ุงูุชูุซูู ุงูุฐูุจู',
      remaining: 98 - rate,
      icon: '๐',
      color: 'amber'
    };
  }
  return {
    level: 'MAX',
    levelName: 'ุงููุณุชูู ุงูุฃูุตู',
    remaining: 0,
    icon: '๐',
    color: 'amber'
  };
}

// GET - ุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
export async function GET(request) {
  try {
    // ุงูุชุญูู ูู ุงูู token
    const decoded = verifyToken(request);
    
    if (!decoded) {
      return NextResponse.json(
        { error: 'ุบูุฑ ูุตุฑุญ. ุงูุฑุฌุงุก ุชุณุฌูู ุงูุฏุฎูู.' },
        { status: 401 }
      );
    }

    const userId = decoded.userId;

    // ุฌูุจ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
    const statsResult = await query(
      `SELECT 
        total_prayers_given,
        total_notifications_received,
        interaction_rate,
        last_prayer_date
       FROM user_stats 
       WHERE user_id = $1`,
      [userId]
    );

    if (statsResult.rows.length === 0) {
      // ุฅูุดุงุก ุณุฌู ุฅุญุตุงุฆูุงุช ุฅุฐุง ูู ููู ููุฌูุฏุงู
      await query(
        `INSERT INTO user_stats (user_id, total_prayers_given, total_notifications_received, interaction_rate)
         VALUES ($1, 0, 0, 0)`,
        [userId]
      );
      
      return NextResponse.json({
        success: true,
        stats: {
          totalPrayersGiven: 0,
          totalNotificationsReceived: 0,
          interactionRate: 0,
          lastPrayerDate: null,
          prayersThisMonth: 0,
          prayersReceivedCount: 0,
          answeredPrayers: 0,
          verificationLevel: {
            name: 'NONE',
            color: 'stone',
            icon: '',
            threshold: 0
          },
          unlockedFeatures: [],
          nextLevel: {
            level: 'BLUE',
            levelName: 'ุงูุชูุซูู ุงูุฃุฒุฑู',
            remaining: 80,
            icon: 'โ',
            color: 'blue'
          }
        }
      });
    }

    const stats = statsResult.rows[0];

    // ุญุณุงุจ ุฏุนูุงุช ูุฐุง ุงูุดูุฑ
    const monthPrayersResult = await query(
      `SELECT COUNT(*) as count
       FROM prayers
       WHERE user_id = $1 
       AND created_at >= DATE_TRUNC('month', CURRENT_DATE)`,
      [userId]
    );

    // ุญุณุงุจ ุนุฏุฏ ูู ุฏุนูุง ูููุณุชุฎุฏู
    const receivedPrayersResult = await query(
      `SELECT COUNT(DISTINCT pr.user_id) as count
       FROM prayer_requests pr
       JOIN prayers p ON pr.id = p.request_id
       WHERE pr.requester_id = $1`,
      [userId]
    );

    // ุญุณุงุจ ุงูุทูุจุงุช ุงููุณุชุฌุงุจุฉ
    const answeredResult = await query(
      `SELECT COUNT(*) as count
       FROM prayer_requests
       WHERE requester_id = $1 AND status = 'answered'`,
      [userId]
    );

    // ุญุณุงุจ ูุนุฏู ุงูุชูุงุนู ูุงูุชูุซูู
    const interactionRate = calculateInteractionRate(
      parseInt(stats.total_prayers_given),
      parseInt(stats.total_notifications_received)
    );

    const verificationLevel = getVerificationLevel(interactionRate);
    const unlockedFeatures = getUnlockedFeatures(interactionRate);
    const nextLevel = calculateNextLevel(interactionRate);

    return NextResponse.json({
      success: true,
      stats: {
        totalPrayersGiven: parseInt(stats.total_prayers_given),
        totalNotificationsReceived: parseInt(stats.total_notifications_received),
        interactionRate,
        lastPrayerDate: stats.last_prayer_date,
        prayersThisMonth: parseInt(monthPrayersResult.rows[0].count),
        prayersReceivedCount: parseInt(receivedPrayersResult.rows[0].count),
        answeredPrayers: parseInt(answeredResult.rows[0].count),
        verificationLevel: {
          name: verificationLevel.name,
          color: verificationLevel.color,
          icon: verificationLevel.icon,
          threshold: verificationLevel.threshold
        },
        unlockedFeatures,
        nextLevel
      }
    });

  } catch (error) {
    console.error('Stats fetch error:', error);
    return NextResponse.json(
      { error: 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุฅุญุตุงุฆูุงุช' },
      { status: 500 }
    );
  }
}

// POST - ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู (ุนูุฏ ุงูููุงู ุจุฏุนุงุก ุฌุฏูุฏ)
export async function POST(request) {
  try {
    // ุงูุชุญูู ูู ุงูู token
    const decoded = verifyToken(request);
    
    if (!decoded) {
      return NextResponse.json(
        { error: 'ุบูุฑ ูุตุฑุญ. ุงูุฑุฌุงุก ุชุณุฌูู ุงูุฏุฎูู.' },
        { status: 401 }
      );
    }

    const userId = decoded.userId;

    // ุชุญุฏูุซ ุงูุนุฏุงุฏ
    await query(
      `UPDATE user_stats 
       SET 
         total_prayers_given = total_prayers_given + 1,
         last_prayer_date = NOW(),
         interaction_rate = CASE 
           WHEN total_notifications_received > 0 
           THEN (total_prayers_given + 1)::float / total_notifications_received * 100
           ELSE 0
         END
       WHERE user_id = $1`,
      [userId]
    );

    // ุฌูุจ ุงูุฅุญุตุงุฆูุงุช ุงููุญุฏุซุฉ
    const updatedStats = await query(
      `SELECT total_prayers_given, total_notifications_received, interaction_rate 
       FROM user_stats 
       WHERE user_id = $1`,
      [userId]
    );

    const stats = updatedStats.rows[0];
    const interactionRate = calculateInteractionRate(
      parseInt(stats.total_prayers_given),
      parseInt(stats.total_notifications_received)
    );

    const verificationLevel = getVerificationLevel(interactionRate);
    const unlockedFeatures = getUnlockedFeatures(interactionRate);
    const nextLevel = calculateNextLevel(interactionRate);

    return NextResponse.json({
      success: true,
      stats: {
        totalPrayersGiven: parseInt(stats.total_prayers_given),
        interactionRate,
        verificationLevel: {
          name: verificationLevel.name,
          color: verificationLevel.color,
          icon: verificationLevel.icon,
          threshold: verificationLevel.threshold
        },
        unlockedFeatures,
        nextLevel
      }
    });

  } catch (error) {
    console.error('Stats update error:', error);
    return NextResponse.json(
      { error: 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช' },
      { status: 500 }
    );
  }
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\app\api\users\top-weekly\route.js ---
// GET endpoint - Get top interactor of the week

// Logic:
// 1. SELECT user_id, COUNT(*) as prayer_count
//    FROM prayers
//    WHERE created_at > NOW() - INTERVAL '7 days'
//    GROUP BY user_id
//    ORDER BY prayer_count DESC
//    LIMIT 1

// 2. JOIN with users to get name + verification

// Return: {
//   id, 
//   displayName, 
//   verificationLevel, 
//   prayersThisWeek,
//   showName (if user opted in)
// }

=== ALL PAGE COMPONENTS ===

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\AboutPage.js ---
// ===============================================
// โน๏ธ ุตูุญุฉ ูู ูุญู (About Page)
// ูุตุฉ ุงูููุตุฉ + ูููุฐุฌ ุงูุชูุงุตู
// ===============================================

import { useState } from 'react';
import { Mail } from 'lucide-react';
import IslamicBanner from '../shared/IslamicBanner';
import MenuBar from '../shared/MenuBar';

export default function AboutPage({ user, onNavigate, onEditProfile }) {
  const [contactMessage, setContactMessage] = useState('');

  const handleSendMessage = () => {
    if (!contactMessage.trim()) {
      alert('ุงูุฑุฌุงุก ูุชุงุจุฉ ุฑุณุงูุฉ');
      return;
    }
    // TODO: ุฑุจุท ุจู API ุฅุฑุณุงู ุงูุจุฑูุฏ
    alert('ุชู ุฅุฑุณุงู ุฑุณุงูุชู ุจูุฌุงุญ! ุณูุฑุฏ ุนููู ูุฑูุจุงู ุฅู ุดุงุก ุงููู');
    setContactMessage('');
  };

  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      {/* ๐ ุงูุจุงูุฑ */}
      <IslamicBanner />
      
      {/* ๐ฑ ุงููุงุฆูุฉ */}
      <MenuBar 
        user={user}
        currentPage="about"
        onNavigate={onNavigate}
        onEditProfile={onEditProfile}
      />
      
      {/* ๐ ุงููุญุชูู */}
      <div className="flex-1 p-4">
        <div className="max-w-2xl mx-auto bg-white rounded-lg border border-stone-200 p-8">
          
          {/* ๐ ุงููุตุฉ */}
          <div className="text-center mb-6">
            <div className="text-4xl mb-4">๐</div>
            <h2 className="text-2xl font-semibold text-stone-800 mb-6">ูู ูุญู</h2>
          </div>
          
          <div className="space-y-4 text-stone-700 leading-relaxed">
            <p>ุฐุงุช ูููุ ูุฑุฑุช ุจูุญูุฉ ุตุนุจุฉ...</p>
            
            <p>ูู ูุง ููุช ุฃุญุชุงุฌู ูู ุฏุนูุฉ ุตุงุฏูุฉ ูู ููุจ ูุคูู</p>
            
            <p>
              ุงูุฏุนุงุก ุบููุฑ ุญูุงุชู ุจุฅุฐู ุงูููุ ูุฃูููุช ุฃู ุงููู ูุฑูุฏูุง ุฃู ูุฏุนูู ูุฃู ูุฏุนู ูุจุนุถูุง ุงูุจุนุถ
            </p>
            
            {/* ๐ ุงูุขูุฉ */}
            <div className="bg-amber-50 border border-amber-200 rounded-lg p-5 my-6">
              <p className="text-center" style={{fontFamily: 'Traditional Arabic, serif'}}>
                ๏ดฟ ุงุฏูุนููููู ุฃูุณูุชูุฌูุจู ูููููู ๏ดพ
              </p>
            </div>
            
            <p>
              ุงูุฏุนุงุก ูุบูุฑ ูุณุงุฑุงุช ุงููุฏุฑ ุจุฅุฐู ุงูููุ ููุฏ ูููู ุฏุนุงุคู ุณุจุจ ูุฑุฌ ุฅูุณุงู
            </p>
            
            <p>ุฃุชููู ุฃู ุชุชุบูุฑ ุญูุงุฉ ุงูุฌููุน ููุฃุญุณูุ ุจุฅุฐู ุงููู ๐คฒ</p>
          </div>

          {/* โ๏ธ ูููุฐุฌ ุงูุชูุงุตู */}
          <div className="mt-8 pt-8 border-t border-stone-200">
            <h3 className="text-lg font-semibold text-stone-800 mb-4 flex items-center gap-2">
              <Mail className="w-5 h-5" />
              ุชูุงุตู ูุนูุง
            </h3>
            
            <textarea
              value={contactMessage}
              onChange={(e) => setContactMessage(e.target.value)}
              placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..."
              rows="4"
              className="w-full px-4 py-3 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none resize-none"
            />
            
            <button
              onClick={handleSendMessage}
              className="w-full mt-4 bg-emerald-600 hover:bg-emerald-700 text-white py-2.5 rounded-lg font-medium transition-colors"
            >
              ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุฅู ุดุงุก ุงููู
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\AchievementsPage.js ---
// ===============================================
// ๐ ุตูุญุฉ ุงูุฅูุฌุงุฒุงุช (Achievements Page)
// ุนุฑุถ ุงูุชูุฏู ูุงููุณุชููุงุช
// ===============================================

import { useState, useEffect } from 'react';
import IslamicBanner from '../shared/IslamicBanner';
import MenuBar from '../shared/MenuBar';
import { achievements } from '../constants/messages';

// ูุณุชููุงุช ุงูุชูุซูู
const VERIFICATION_LEVELS = {
  BLUE: {
    name: 'ุงูุชูุซูู ุงูุฃุฒุฑู',
    threshold: 80,
    icon: 'โ',
    color: 'blue'
  },
  GREEN: {
    name: 'ุงูุชูุซูู ุงูุฃุฎุถุฑ',
    threshold: 90,
    icon: 'โโ',
    color: 'emerald'
  },
  GOLD: {
    name: 'ุงูุชูุซูู ุงูุฐูุจู',
    threshold: 98,
    icon: '๐',
    color: 'amber'
  }
};

export default function AchievementsPage({ user, onNavigate, onEditProfile, onLogout }) {
  // ๐ ุญุงูุฉ ุงูุฅุญุตุงุฆูุงุช
  const [userStats, setUserStats] = useState(null);
  const [loading, setLoading] = useState(true);

  // ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู API
  useEffect(() => {
    if (user) {
      const token = localStorage.getItem('token');
      
      fetch('/api/users/stats', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            setUserStats(data.stats);
          }
          setLoading(false);
        })
        .catch(err => {
          console.error('Error fetching stats:', err);
          setLoading(false);
        });
    }
  }, [user]);

  if (loading) {
    return (
      <div className="min-h-screen bg-stone-50 flex items-center justify-center">
        <p className="text-stone-600">ุฌุงุฑู ุงูุชุญููู...</p>
      </div>
    );
  }

  const userPrayerCount = userStats?.prayersThisMonth || 0;
  
  // ๐ฏ ุงูุฅูุฌุงุฒ ุงููุงุฏู
  const nextAchievement = achievements.find(a => a.count > userPrayerCount) || achievements[achievements.length - 1];
  const remaining = nextAchievement.count - userPrayerCount;
  const progress = (userPrayerCount / nextAchievement.count) * 100;

  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      {/* ๐ ุงูุจุงูุฑ */}
      <IslamicBanner />
      
      {/* ๐ฑ ุงููุงุฆูุฉ */}
      <MenuBar 
        user={user}
        currentPage="achievements"
        onNavigate={onNavigate}
        onEditProfile={onEditProfile}
        onLogout={onLogout}
      />
      
      {/* ๐ ุงููุญุชูู */}
      <div className="flex-1 p-4">
        <div className="max-w-2xl mx-auto space-y-4">
          
          {/* ๐ ุงูุนุฏุงุฏ ุงูุชุญููุฒู */}
          <div className="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-lg border border-emerald-200 p-6">
            <div className="text-center mb-4">
              <div className="text-4xl font-bold text-emerald-700 mb-2">
                {userPrayerCount}
              </div>
              <p className="text-stone-600">ุฏุนุงุก ูุฐุง ุงูุดูุฑ</p>
            </div>

            {/* ุดุฑูุท ุงูุชูุฏู */}
            <div className="mb-4">
              <div className="w-full bg-emerald-200 rounded-full h-3 overflow-hidden">
                <div 
                  className="bg-emerald-600 h-full transition-all duration-500"
                  style={{width: `${Math.min(progress, 100)}%`}}
                ></div>
              </div>
            </div>

            <div className="text-center">
              <p className="text-sm text-stone-600 mb-2">
                ุจุงูู <span className="font-bold text-emerald-700">{remaining}</span> {remaining === 1 ? 'ุฏุนุงุก' : 'ุฏุนูุงุช'} ูุชุตู ุฅูู:
              </p>
              <p className="text-emerald-700 font-semibold">
                {nextAchievement.icon} {nextAchievement.title}
              </p>
            </div>
          </div>

          {/* ๐ ุดุงุฑุงุช ุงูุชูุซูู */}
          {userStats && (
            <div className="bg-white p-6 rounded-lg border border-stone-200">
              <h3 className="text-lg font-bold text-stone-800 mb-4">
                ุดุงุฑุงุช ุงูุชูุซูู
              </h3>
              
              <div className="grid grid-cols-1 gap-4">
                {Object.values(VERIFICATION_LEVELS).filter(l => l.threshold > 0).map(level => {
                  const isUnlocked = userStats.interactionRate >= level.threshold;
                  
                  return (
                    <div 
                      key={level.name} 
                      className={`p-4 rounded-lg border-2 transition-all ${
                        isUnlocked 
                          ? 'border-emerald-500 bg-emerald-50' 
                          : 'border-stone-200 bg-stone-50 opacity-60'
                      }`}
                    >
                      <div className="flex items-center justify-between">
                        <div>
                          <h4 className="font-bold text-stone-800">{level.name}</h4>
                          <p className="text-sm text-stone-600">ูุนุฏู ุชูุงุนู {level.threshold}%+</p>
                        </div>
                        <div className="text-3xl">{level.icon}</div>
                      </div>
                      {isUnlocked && (
                        <p className="text-emerald-600 text-sm mt-2">โ ุชู ูุชุญ ูุฐู ุงูุดุงุฑุฉ</p>
                      )}
                      {!isUnlocked && (
                        <p className="text-stone-500 text-sm mt-2">
                          ุจุงูู {level.threshold - userStats.interactionRate}% ูููุชุญ
                        </p>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {/* ๐ ูุงุฆูุฉ ุงูุฅูุฌุงุฒุงุช */}
          <div className="bg-white rounded-lg border border-stone-200 p-6">
            <h3 className="font-semibold text-stone-800 mb-4 text-center">
              ูุณุชููุงุช ุงูุฅูุฌุงุฒุงุช
            </h3>
            <div className="space-y-3">
              {achievements.map((achievement, idx) => {
                const isCompleted = userPrayerCount >= achievement.count;
                const isCurrent = achievement.count === nextAchievement.count;
                
                return (
                  <div 
                    key={idx}
                    className={`p-4 rounded-lg border-2 transition-all ${
                      isCompleted 
                        ? 'bg-emerald-50 border-emerald-500' 
                        : isCurrent
                          ? 'bg-amber-50 border-amber-500'
                          : 'bg-stone-50 border-stone-200'
                    }`}
                  >
                    <div className="flex items-start gap-3">
                      <div className="text-2xl">{achievement.icon}</div>
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-bold text-stone-800">
                            {achievement.count}
                          </span>
                          {isCompleted && <span className="text-emerald-600">โ</span>}
                          {isCurrent && <span className="text-amber-600">โ ุงููุฏู ุงูุญุงูู</span>}
                        </div>
                        <p className="text-sm text-stone-600">{achievement.title}</p>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          {/* ๐ฌ ุฑุณุงูุฉ ุชุญููุฒูุฉ */}
          <div className="bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg border border-amber-200 p-6 text-center">
            <p className="text-stone-700 leading-relaxed">
              "ูู ุฏุนุงุก ุชุฏุนูู ูููุชุจ ูู<br/>ูุชุฏุนู ูู ุงูููุงุฆูุฉ ุจูุซูู ุฅู ุดุงุก ุงููู"
            </p>
            <div className="text-3xl mt-3">๐คฒ</div>
          </div>
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\FAQPage.js ---
// ===============================================
// โ ุตูุญุฉ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ (FAQ Page)
// ุงูุฃุณุฆูุฉ ูุงูุฃุฌูุจุฉ ุงูุดุงุฆุนุฉ
// ===============================================

import { HelpCircle } from 'lucide-react';
import IslamicBanner from '../shared/IslamicBanner';
import MenuBar from '../shared/MenuBar';

export default function FAQPage({ user, onNavigate, onEditProfile }) {
  // ๐ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ
  const faqs = [
    {
      q: 'ููู ูุนูู ุงููููุนุ',
      a: 'ุชููู ุจุงูุชุณุฌูู ุจุงุณูู ูุงุณู ูุงูุฏุชูุ ุซู ููููู ุทูุจ ุงูุฏุนุงุก ุฃู ุงูุฏุนุงุก ููุขุฎุฑูู. ุณุชุตูู ุฅุดุนุงุฑุงุช ูู 30 ุฏูููุฉ ุนูุฏูุง ูุทูุจ ุฃุญุฏ ุงูุฏุนุงุก ุฅู ุดุงุก ุงููู.'
    },
    {
      q: 'ููุงุฐุง ูุทูุจ ุงุณู ุงูุฃูุ',
      a: 'ุงูุฏุนุงุก ุจุงูุงุณู ูุงุณู ุงูุฃู ูู ููุฉ ุฑูุญุงููุฉ ุฎุงุตุฉ ูู ูู ุงูุฃุฏูุงูุ ููู ุฃุฏู ูู ุงูุชุนุฑูู ุจุงูุดุฎุต.'
    },
    {
      q: 'ูู ุฃุญุชุงุฌ ููุชุงุจุฉ ุชูุงุตูู ุญุงุฌุชูุ',
      a: 'ูุงุ ุงุญุชูุธ ุจุญุงุฌุชู ูู ููุจู. ุงููู ูุนูู ูุง ุชุฑูุฏุ ูุงููุคูููู ูุฏุนูู ูู ุจุงูุฎูุฑ ุงูุนุงู.'
    },
    {
      q: 'ูู ูุฑุฉ ูููููู ุทูุจ ุงูุฏุนุงุกุ',
      a: 'ููููู ุทูุจ ุงูุฏุนุงุก ูู ุฃู ููุช ุชุญุชุงุฌู. ููุตุญ ุจุงูุชุจุงุนุฏ ุจูู ุงูุทูุจุงุช ูุฅุนุทุงุก ุงููุฑุตุฉ ูููุคูููู ููุฏุนุงุก ูู.'
    },
    {
      q: 'ููู ุฃุนุฑู ุฃู ุฏุนุงุฆู ุงุณุชูุฌูุจุ',
      a: 'ุจุนุฏ 24 ุณุงุนุฉ ูู ุทูุจูุ ุณูุณุฃูู ุนู ุญุงูุชู. ุฅุฐุง ุชูุณุฑุช ุญุงุฌุชูุ ุณูุชู ุฅุนูุงู ูู ูู ุฏุนุง ูู ุจุงูุจุดุฑู ุฅู ุดุงุก ุงููู.'
    },
    {
      q: 'ูู ุงููููุน ูุฌุงููุ',
      a: 'ูุนู ุชูุงูุงู. ุงูููุตุฉ ูุฌุงููุฉ ููุฌููุน. ูุฏููุง ูุดุฑ ุงูุฎูุฑ ูุงูุฏุนุงุก ุงููุดุชุฑู.'
    },
    {
      q: 'ููู ุฃุซุจุช ุงูุชุทุจูู ุนูู ููุจุงูููุ',
      a: 'ุนูุฏ ุฒูุงุฑุฉ ุงููููุนุ ุณูุธูุฑ ูู ุฎูุงุฑ "ุชุซุจูุช ุงูุชุทุจูู" ุฃู "ุฅุถุงูุฉ ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ" ูู ูุชุตูุญู.'
    },
    {
      q: 'ูู ูุนูููุงุชู ุขููุฉุ',
      a: 'ูุนูุ ูุญู ูุญุชุฑู ุฎุตูุตูุชู. ููุท ุงูุงุณู ูุงุณู ุงูุฃู ูุธูุฑุงู ูููุคููููุ ูููุณ ูุฏููุง ุจูุงูุงุชู ุงูุดุฎุตูุฉ ุงูุฃุฎุฑู.'
    },
    {
      q: 'ูู ูููููู ุงูุฏุนุงุก ููุชูููุ',
      a: 'ูุนูุ ููุฌุฏ ุฒุฑ ุฎุงุต ููุฏุนุงุก ูููุชูููู. ููููู ุฅุฏุฎุงู ุงุณู ุงููุชููู ูุงุณู ูุงูุฏุชู ูุตูุฉ ุงููุฑุงุจุฉ.'
    },
    {
      q: 'ูุงุฐุง ุฃูุนู ุฅุฐุง ูู ุชุตููู ุฅุดุนุงุฑุงุชุ',
      a: 'ุชุฃูุฏ ูู ุชุซุจูุช ุงูุชุทุจูู ุนูู ุดุงุดุชู ุงูุฑุฆูุณูุฉ ูุงูุณูุงุญ ุจุงูุฅุดุนุงุฑุงุช ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ.'
    }
  ];

  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      {/* ๐ ุงูุจุงูุฑ */}
      <IslamicBanner />
      
      {/* ๐ฑ ุงููุงุฆูุฉ */}
      <MenuBar 
        user={user}
        currentPage="faq"
        onNavigate={onNavigate}
        onEditProfile={onEditProfile}
      />
      
      {/* ๐ ุงููุญุชูู */}
      <div className="flex-1 p-4">
        <div className="max-w-2xl mx-auto space-y-3">
          {faqs.map((faq, idx) => (
            <div key={idx} className="bg-white rounded-lg border border-stone-200 p-5">
              <h3 className="font-semibold text-stone-800 mb-2 flex items-start gap-2">
                <HelpCircle className="w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5" />
                {faq.q}
              </h3>
              <p className="text-stone-600 text-sm leading-relaxed mr-7">
                {faq.a}
              </p>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\HomePage.js ---
// ===============================================
// ๐ก ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (Home Page)
// ุนุฑุถ ุทูุจุงุช ุงูุฏุนุงุก + ุฅุฑุณุงู ุทูุจ ุฌุฏูุฏ
// ===============================================

import { useState, useEffect } from 'react';
import { Share2, Send, X } from 'lucide-react';
import IslamicBanner from '../shared/IslamicBanner';
import MenuBar from '../shared/MenuBar';
import CountdownTimer from '../shared/CountdownTimer';
import VerificationBadge from '../shared/VerificationBadge';
import ReactionButtons from '../shared/ReactionButtons';
import TopWeeklyUser from '../shared/TopWeeklyUser';
import InstallPrompt from '../shared/InstallPrompt';
import ShareButton from '../shared/ShareButton';
import { encouragingMessages, blessingsExample, TOTAL_USERS } from '../constants/messages';

export default function HomePage({ user, onNavigate, onEditProfile, onLogout }) {
  // ๐ฒ ุฑุณุงูุฉ ุชุดุฌูุนูุฉ ุนุดูุงุฆูุฉ
  const [randomMessage] = useState(
    encouragingMessages[Math.floor(Math.random() * encouragingMessages.length)]
  );

  // โฐ ุญุฏูุฏ ุงูุทูุจุงุช (Time Limits)
  const [prayerLimit, setPrayerLimit] = useState({
    canRequest: true,
    remainingSeconds: 0,
    nextAllowedAt: null
  });

  const [deceasedLimit, setDeceasedLimit] = useState({
    canRequest: true,
    remainingSeconds: 0,
    nextAllowedAt: null
  });

  // ๐ ุทูุจุงุช ุงูุฏุนุงุก (ุจูุงูุงุช ููููุฉ)
  const [requests] = useState([
    {
      id: 1,
      userId: 123,
      userName: 'ุฃุญูุฏ ุจู ุณุงุฑุฉ',
      type: 'need',
      timestamp: new Date(Date.now() - 5 * 60000),
      prayerCount: 12,
      prayed: false,
      verificationLevel: {
        name: 'BLUE',
        color: 'blue',
        icon: 'โ',
        threshold: 80
      }
    },
    {
      id: 2,
      userId: 456,
      userName: 'ูุงุฑูุง ุจูุช ูุงุซุฑูู',
      type: 'need',
      timestamp: new Date(Date.now() - 15 * 60000),
      prayerCount: 8,
      prayed: false,
      verificationLevel: {
        name: 'GREEN',
        color: 'emerald',
        icon: 'โโ',
        threshold: 90
      }
    },
    {
      id: 3,
      userId: 789,
      deceasedName: 'ููุณู ุจู ูุฑูู',
      relation: 'ุฃุจ',
      type: 'deceased',
      timestamp: new Date(Date.now() - 20 * 60000),
      prayerCount: 15,
      prayed: false,
      verificationLevel: null
    }
  ]);

  // ๐๏ธ ูููุฐุฌ ุงูุฏุนุงุก ูููุชููู
  const [showDeceasedForm, setShowDeceasedForm] = useState(false);
  const [deceasedForm, setDeceasedForm] = useState({
    fullName: '',
    motherName: '',
    relation: ''
  });

  // ๐ ููุฒุงุช ุงูุชูุซูู ุงููุชูุฏู
  const [stats, setStats] = useState(null);
  const [canCollective, setCanCollective] = useState(false);
  const [canPrivate, setCanPrivate] = useState(false);
  const [selectedUser, setSelectedUser] = useState('');
  const [activeUsers] = useState([
    { id: 1, displayName: 'ุฃุญูุฏ ุจู ุณุงุฑุฉ', verificationLevel: { icon: 'โ' } },
    { id: 2, displayName: 'ูุงุฑูุง ุจูุช ูุงุซุฑูู', verificationLevel: { icon: 'โโ' } },
    { id: 3, displayName: 'ูุงุทูุฉ ุจูุช ุนูู', verificationLevel: { icon: '๐' } }
  ]);

  // ๐ ุฃูุถู ูุณุชุฎุฏู ุฃุณุจูุนูุงู
  const [topWeeklyUser, setTopWeeklyUser] = useState(null);

  // โฐ ุงูุชุญูู ูู ุญุฏูุฏ ุงูุทูุจุงุช ุนูุฏ ุงูุชุญููู
  useEffect(() => {
    if (user) {
      const token = localStorage.getItem('token');
      if (!token) return;

      fetch('/api/prayer-request/check-limit', {
        headers: { Authorization: `Bearer ${token}` }
      })
        .then(res => res.json())
        .then(data => {
          setPrayerLimit({
            canRequest: data.canRequestPrayer,
            remainingSeconds: data.remainingSeconds?.prayer || 0,
            nextAllowedAt: data.nextPrayerAllowedAt
          });
          setDeceasedLimit({
            canRequest: data.canRequestDeceased,
            remainingSeconds: data.remainingSeconds?.deceased || 0,
            nextAllowedAt: data.nextDeceasedAllowedAt
          });
        })
        .catch(err => console.error('Error checking limits:', err));
    }
  }, [user]);

  // ๐ ุฌูุจ ุจูุงูุงุช ุงูุชูุซูู ูุงูููุฒุงุช
  useEffect(() => {
    if (user) {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      fetch('/api/users/stats', {
        headers: { 'Authorization': `Bearer ${token}` }
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            setStats(data.stats);
            setCanCollective(data.stats.unlockedFeatures?.includes('collective_prayer') || false);
            setCanPrivate(data.stats.unlockedFeatures?.includes('private_prayer') || false);
          }
        })
        .catch(err => console.error('Error fetching stats:', err));
    }
  }, [user]);

  // ๐ ุฌูุจ ุฃูุถู ูุณุชุฎุฏู ุฃุณุจูุนูุงู
  useEffect(() => {
    fetch('/api/users/top-weekly')
      .then(res => res.json())
      .then(data => setTopWeeklyUser(data))
      .catch(err => console.error('Error fetching top weekly user:', err));
  }, []);

  // ๐ ุญุณุงุจ ุงูููุช
  const getTimeAgo = (timestamp) => {
    const mins = Math.floor((Date.now() - timestamp) / 60000);
    if (mins < 1) return 'ุงูุขู';
    if (mins === 1) return 'ููุฐ ุฏูููุฉ';
    if (mins < 60) return `ููุฐ ${mins} ุฏูููุฉ`;
    const hours = Math.floor(mins / 60);
    if (hours === 1) return 'ููุฐ ุณุงุนุฉ';
    if (hours < 24) return `ููุฐ ${hours} ุณุงุนุฉ`;
    const days = Math.floor(hours / 24);
    return `ููุฐ ${days} ููู`;
  };

  const handleRequestPrayer = async () => {
    // TODO: ุฑุจุท ุจู API
    alert('ุชู ุฅุฑุณุงู ุทูุจู! ุณูุตู ุฅุดุนุงุฑ ูููุคูููู ุฎูุงู 30 ุฏูููุฉ ุฅู ุดุงุก ุงููู');
  };

  const handleDeceasedPrayer = () => {
    if (!deceasedForm.fullName || !deceasedForm.motherName) {
      alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุงุณู ุงููุงูู ูุงุณู ุงูุฃู ูููุชููู');
      return;
    }
    // TODO: ุฑุจุท ุจู API
    alert('ุชู ุฅุฑุณุงู ุทูุจ ุงูุฏุนุงุก ูููุชููู ุฅู ุดุงุก ุงููู');
    setShowDeceasedForm(false);
    setDeceasedForm({ fullName: '', motherName: '', relation: '' });
  };

  const handleReact = async (requestId, reactionType) => {
    // TODO: ุฑุจุท ุจู API
    console.log('React:', requestId, reactionType);
    alert(`ุชู ุฅุฑุณุงู ุฑุฏ ุงููุนู: ${reactionType}`);
  };

  const handleCollectivePrayer = async () => {
    // TODO: ุฑุจุท ุจู API
    alert('ุชู ุฅุฑุณุงู ุฏุนุงุกู ููู ุงููุคูููู! ุฌุฒุงู ุงููู ุฎูุฑุงู ๐');
  };

  const handlePrivatePrayer = async () => {
    if (!selectedUser) {
      alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุดุฎุต ููุฏุนุงุก ูู');
      return;
    }
    // TODO: ุฑุจุท ุจู API
    alert('ุชู ุฅุฑุณุงู ุฏุนุงุก ุฎุงุต ุฅู ุดุงุก ุงููู โญ');
    setSelectedUser('');
  };

  return (
    <div className="min-h-screen bg-stone-50 pb-20">
      {/* ๐ ุงูุจุงูุฑ */}
      <IslamicBanner />
      
      {/* ๐ฑ ุงููุงุฆูุฉ */}
      <MenuBar 
        user={user}
        currentPage="home"
        onNavigate={onNavigate}
        onEditProfile={onEditProfile}
        onLogout={onLogout}
      />

      <div className="max-w-2xl mx-auto px-4 py-6 space-y-4">
        
        {/* ๐ฅ ุนุฏุงุฏ ุงููุณุชุฎุฏููู */}
        <div className="bg-gradient-to-r from-emerald-50 to-emerald-100 border border-emerald-200 rounded-lg p-4 text-center">
          <p className="text-emerald-700 font-semibold text-lg">
            ๐ ุงูุถู ุฅูู {TOTAL_USERS.toLocaleString()} ูุคูู
          </p>
          <p className="text-emerald-600 text-sm">ูู ุญูู ุงูุนุงูู</p>
        </div>

        {/* ๐ฌ ุฑุณุงูุฉ ุชุดุฌูุนูุฉ */}
        <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
          <p className="text-stone-700 text-sm leading-relaxed whitespace-pre-line text-center">
            {randomMessage}
          </p>
        </div>

        {/* ๐ ุฃุฒุฑุงุฑ ุงูุทูุจ */}
        <div className="grid grid-cols-1 gap-4">
          {/* ุฒุฑ ุทูุจ ุงูุฏุนุงุก */}
          {prayerLimit.canRequest ? (
            <button
              onClick={handleRequestPrayer}
              className="bg-emerald-600 hover:bg-emerald-700 text-white p-6 rounded-lg transition-colors"
            >
              <div className="text-center">
                <div className="text-3xl mb-2">๐คฒ</div>
                <h3 className="text-lg font-semibold mb-2">ุงุญุชุงุฌ ุฏุนุงุกูู</h3>
                <p className="text-sm opacity-90">
                  ุงุญุชูุธ ุจุญุงุฌุชู ูู ููุจู ูุฏุน ุงููุคูููู ูุดุงุฑูููู ุงูุฏุนุงุก
                </p>
              </div>
            </button>
          ) : (
            <div className="bg-emerald-600 opacity-60 text-white p-6 rounded-lg">
              <div className="text-center">
                <div className="text-3xl mb-2">๐คฒ</div>
                <h3 className="text-lg font-semibold mb-2">ุงุญุชุงุฌ ุฏุนุงุกูู</h3>
                <p className="text-sm opacity-90 mb-3">
                  ุงุญุชูุธ ุจุญุงุฌุชู ูู ููุจู ูุฏุน ุงููุคูููู ูุดุงุฑูููู ุงูุฏุนุงุก
                </p>
                <CountdownTimer 
                  targetTimestamp={prayerLimit.nextAllowedAt}
                  onComplete={() => setPrayerLimit({...prayerLimit, canRequest: true})}
                  label="ููููู ุทูุจ ุฏุนุงุก ุฌุฏูุฏ ุจุนุฏ"
                />
              </div>
            </div>
          )}

          {/* ุฒุฑ ุงูุฏุนุงุก ูููุชููู */}
          {deceasedLimit.canRequest ? (
            <button
              onClick={() => setShowDeceasedForm(true)}
              className="bg-stone-600 hover:bg-stone-700 text-white p-6 rounded-lg transition-colors"
            >
              <div className="text-center">
                <div className="text-3xl mb-2">๐๏ธ</div>
                <h3 className="text-lg font-semibold mb-2">ุงุฏุนูุง ููุชููู ุนุฒูุฒ</h3>
                <p className="text-sm opacity-90">
                  ุงุฏุนู ูุฑูุญ ูู ูุงุฑููุง ูุงุทูุจ ูู ุงููุคูููู ุงูุฏุนุงุก ูู
                </p>
              </div>
            </button>
          ) : (
            <div className="bg-stone-600 opacity-60 text-white p-6 rounded-lg">
              <div className="text-center">
                <div className="text-3xl mb-2">๐๏ธ</div>
                <h3 className="text-lg font-semibold mb-2">ุงุฏุนูุง ููุชููู ุนุฒูุฒ</h3>
                <p className="text-sm opacity-90 mb-3">
                  ุงุฏุนู ูุฑูุญ ูู ูุงุฑููุง ูุงุทูุจ ูู ุงููุคูููู ุงูุฏุนุงุก ูู
                </p>
                <CountdownTimer 
                  targetTimestamp={deceasedLimit.nextAllowedAt}
                  onComplete={() => setDeceasedLimit({...deceasedLimit, canRequest: true})}
                  label="ููููู ุทูุจ ุฏุนุงุก ุฌุฏูุฏ ุจุนุฏ"
                />
              </div>
            </div>
          )}
        </div>

        {/* ๐๏ธ ูููุฐุฌ ุงููุชููู */}
        {showDeceasedForm && (
          <div className="bg-white p-6 rounded-lg border border-stone-200">
            <h3 className="text-lg font-semibold text-stone-800 mb-4 text-center">
              ุงูุฏุนุงุก ููู ูุงุฑููุง
            </h3>
            
            <div className="space-y-4">
              <input
                type="text"
                value={deceasedForm.fullName}
                onChange={(e) => setDeceasedForm({...deceasedForm, fullName: e.target.value})}
                placeholder="ุงูุงุณู ุงููุงูู ูููุชููู"
                className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
              />
              
              <input
                type="text"
                value={deceasedForm.motherName}
                onChange={(e) => setDeceasedForm({...deceasedForm, motherName: e.target.value})}
                placeholder="ุงุณู ูุงูุฏุฉ ุงููุชููู"
                className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
              />
              
              <div>
                <label className="block text-stone-700 font-medium mb-2 text-sm">
                  ุตูุฉ ุงููุฑุงุจุฉ (ุงุฎุชูุงุฑู)
                </label>
                <div className="grid grid-cols-3 gap-2">
                  {['ุฃุจ', 'ุฃู', 'ุฃุฎ', 'ุฃุฎุช', 'ุตุฏูู', 'ูุฑูุจ'].map(rel => (
                    <button
                      key={rel}
                      onClick={() => setDeceasedForm({...deceasedForm, relation: rel})}
                      className={`py-2 px-3 rounded-lg text-sm font-medium transition-colors ${
                        deceasedForm.relation === rel
                          ? 'bg-emerald-600 text-white'
                          : 'bg-stone-100 text-stone-700 hover:bg-stone-200'
                      }`}
                    >
                      {rel}
                    </button>
                  ))}
                </div>
              </div>
              
              <div className="flex gap-2">
                <button
                  onClick={handleDeceasedPrayer}
                  className="flex-1 bg-stone-600 hover:bg-stone-700 text-white py-2.5 rounded-lg font-medium transition-colors"
                >
                  ุฅุฑุณุงู ุทูุจ ุงูุฏุนุงุก
                </button>
                <button
                  onClick={() => setShowDeceasedForm(false)}
                  className="px-6 bg-stone-200 hover:bg-stone-300 text-stone-700 py-2.5 rounded-lg font-medium transition-colors"
                >
                  ุฅูุบุงุก
                </button>
              </div>
            </div>
          </div>
        )}

        {/* ๐ ุฅุญุตุงุฆูุฉ ุดุฎุตูุฉ */}
        <div className="bg-white p-5 rounded-lg border border-stone-200 text-center">
          <p className="text-stone-600 text-sm mb-1">ุฏุนุง ูู ุงูููู</p>
          <p className="text-3xl font-semibold text-emerald-600">24</p>
          <p className="text-stone-500 text-sm">ูุคูู</p>
        </div>

        {/* ๐ ุฃูุถู ูุณุชุฎุฏู ุฃุณุจูุนูุงู */}
        {topWeeklyUser && (
          <TopWeeklyUser topUser={topWeeklyUser} />
        )}

        {/* ๐ ููุฒุงุช ุงูุชูุซูู ุงููุชูุฏู */}
        {canCollective && (
          <button
            onClick={handleCollectivePrayer}
            className="bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-6 rounded-lg transition-all hover:shadow-lg"
          >
            <div className="text-center">
              <div className="text-3xl mb-2">๐</div>
              <h3 className="text-lg font-bold mb-1">ุงุฏุนู ููู ุงููุคูููู</h3>
              <p className="text-sm opacity-90">ููุฒุฉ ุงูุชูุซูู ุงููุชูุฏู ๐ข</p>
            </div>
          </button>
        )}

        {canPrivate && (
          <div className="bg-gradient-to-r from-amber-500 to-amber-600 text-white p-6 rounded-lg">
            <div className="text-center mb-3">
              <div className="text-3xl mb-2">โญ</div>
              <h3 className="text-lg font-bold">ุฏุนุงุก ุฎุงุต</h3>
              <p className="text-sm opacity-90 mb-3">ููุฒุฉ ุงูุชูุซูู ุงูุฐูุจู ๐</p>
            </div>
            <select 
              value={selectedUser}
              onChange={(e) => setSelectedUser(e.target.value)}
              className="w-full p-3 rounded-lg text-stone-800 border-0 focus:ring-2 focus:ring-amber-300"
            >
              <option value="">ุงุฎุชุฑ ุดุฎุตุงู...</option>
              {activeUsers.map(u => (
                <option key={u.id} value={u.id}>
                  {u.displayName} {u.verificationLevel?.icon}
                </option>
              ))}
            </select>
            <button 
              onClick={handlePrivatePrayer} 
              className="mt-3 w-full bg-white text-amber-600 py-2.5 rounded-lg font-semibold hover:bg-amber-50 transition-colors"
            >
              ุฅุฑุณุงู ุฏุนุงุก ุฎุงุต
            </button>
          </div>
        )}

        {/* ๐คฒ ูู ูุทูุจ ุฏุนุงุกูุง */}
        <div className="bg-white rounded-lg border border-stone-200 overflow-hidden">
          <div className="bg-emerald-600 p-4 border-b border-emerald-700">
            <h3 className="text-white font-semibold text-center">
              ูู ูุทูุจ ุฏุนุงุกูุง ุงูุขู
            </h3>
          </div>
          
          <div className="divide-y divide-stone-100">
            {requests.map(request => (
              <div key={request.id} className="p-5">
                <div className="flex items-start justify-between mb-3">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="text-xl">{request.type === 'deceased' ? '๐๏ธ' : '๐คฒ'}</span>
                      <h4 className="font-semibold text-stone-800">
                        {request.type === 'deceased' 
                          ? `${request.deceasedName}${request.relation ? ` (${request.relation})` : ''}`
                          : request.userName
                        }
                      </h4>
                      {request.verificationLevel && (
                        <VerificationBadge level={request.verificationLevel} size="sm" />
                      )}
                    </div>
                    <div className="flex items-center gap-3 text-sm text-stone-600 mb-2">
                      <span>{getTimeAgo(request.timestamp)}</span>
                      <span>โข</span>
                      <span>ุฏุนุง ูู {request.prayerCount}</span>
                    </div>
                  </div>
                </div>
                
                {!request.prayed && (
                  <button
                    onClick={() => alert('ุณูุชู ุฑุจุทู ุจู API ุงูุฏุนุงุก')}
                    className={`w-full py-2.5 rounded-lg font-medium transition-colors ${
                      request.type === 'deceased'
                        ? 'bg-stone-600 hover:bg-stone-700 text-white'
                        : 'bg-emerald-600 hover:bg-emerald-700 text-white'
                    }`}
                  >
                    ุฎุฐ ูุญุธุฉ ูุงุฏุนู {request.type === 'deceased' ? 'ูู' : `ูู ${request.userName.split(' ')[0]}`} ๐คฒ
                  </button>
                )}

                {/* Show reactions if user is request owner */}
                {request.userId === user?.id && (
                  <div className="mt-4 pt-4 border-t border-stone-200">
                    <p className="text-sm text-stone-600 mb-2">
                      {request.prayerCount} ุดุฎุต ุฏุนุง ูู
                    </p>
                    <ReactionButtons 
                      requestId={request.id}
                      currentUserReaction={null}
                      onReact={handleReact}
                    />
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>

        {/* ๐ ุจุดุงุฆุฑ ุงูููู */}
        <div className="bg-white rounded-lg border border-stone-200 overflow-hidden">
          <div className="bg-amber-500 p-4 border-b border-amber-600">
            <h3 className="text-white font-semibold text-center">ุจุดุงุฆุฑ ุงูููู</h3>
          </div>
          
          <div className="p-5 space-y-3">
            {blessingsExample.map((blessing, idx) => (
              <div key={idx} className="flex items-center justify-between bg-amber-50 border border-amber-200 p-4 rounded-lg">
                <div>
                  <p className="font-semibold text-stone-800">โ {blessing.name}</p>
                  <p className="text-sm text-stone-600">ุชูุณุฑุช ุญุงุฌุชู ุฅู ุดุงุก ุงููู</p>
                </div>
                <p className="text-sm text-stone-600">ุฏุนุง ูู {blessing.count}</p>
              </div>
            ))}
          </div>
        </div>

        {/* ๐ค ุฒุฑ ุงููุดุงุฑูุฉ */}
        <ShareButton 
          title="ููุตุฉ ุงูุฏุนุงุก ุงูุฌูุงุนู"
          text="ุงุฏุนู ูุงุทูุจ ุงูุฏุนุงุก ูู ุขูุงู ุงููุคูููู ุญูู ุงูุนุงูู ๐คฒ"
          url="https://yojeeb.com"
        />

        {/* ๐ค Footer */}
        <div className="text-center text-sm text-stone-600 py-6 border-t border-stone-200">
          <p className="mb-2">ููุตุฉ ุงูุฏุนุงุก ุงูุฌูุงุนู ยฉ 2025</p>
          <p>ููุฑุฉ ูุชุทููุฑ: <span className="text-emerald-600 font-semibold">ุญูุฏุฑ ุงูุบุงููู  ๐ฟ</span></p>
        </div>
      </div>

      {/* ๐ฒ Install Prompt */}
      <InstallPrompt />
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\LandingPage.js ---
// ===============================================
// ๐ ุตูุญุฉ ุงููุจูุท (Landing Page)
// ุฃูู ุตูุญุฉ ูุฑุงูุง ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ
// ===============================================

import { Users } from 'lucide-react';
import IslamicBanner from '../shared/IslamicBanner';
import { TOTAL_USERS } from '../constants/messages';

export default function LandingPage({ onStart }) {
  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      {/* ๐ ุงูุจุงูุฑ ุงูุนููู */}
      <IslamicBanner />
      
      {/* ๐ ุงููุญุชูู */}
      <div className="flex-1 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-white rounded-lg shadow-sm border border-stone-200 p-8 text-center">
          
          {/* ๐จ ุงูุฃููููุฉ */}
          <div className="w-20 h-20 bg-emerald-600 rounded-full mx-auto flex items-center justify-center mb-6">
            <Users className="w-10 h-10 text-white" />
          </div>

          {/* ๐ ุงูุนููุงู */}
          <h1 className="text-2xl font-semibold text-stone-800 mb-6">
            ููุตุฉ ุงูุฏุนุงุก ุงูุฌูุงุนู
          </h1>
          
          {/* ๐ ุงูุขูุฉ */}
          <div className="bg-amber-50 border border-amber-200 rounded-lg p-5 mb-6">
            <p className="text-stone-700 leading-relaxed text-base" style={{fontFamily: 'Traditional Arabic, serif'}}>
              ๏ดฟ ููุฅูุฐูุง ุณูุฃููููู ุนูุจูุงุฏูู ุนููููู ููุฅููููู ููุฑููุจู ุฃูุฌููุจู ุฏูุนูููุฉู ุงูุฏููุงุนู ุฅูุฐูุง ุฏูุนูุงูู ๏ดพ
            </p>
          </div>
          
          {/* ๐ฌ ุงููุตู */}
          <p className="text-stone-600 text-base leading-relaxed mb-2">
            ุฏุนุงุก ูุงุญุฏ ูุฏ ูุบูุฑ ุญูุงุฉ ุฅูุณุงู
          </p>
          <p className="text-stone-600 text-base leading-relaxed mb-6">
            ููุฏ ูุบูุฑ ุญูุงุชู ุฅู ุดุงุก ุงููู
          </p>

          {/* ๐ฅ ุนุฏุงุฏ ุงููุณุชุฎุฏููู */}
          <div className="mb-6 p-4 bg-emerald-50 border border-emerald-200 rounded-lg">
            <p className="text-emerald-700 font-semibold text-lg">
              ๐ ุงูุถู ุฅูู {TOTAL_USERS.toLocaleString()} ูุคูู
            </p>
            <p className="text-emerald-600 text-sm">ูู ุญูู ุงูุนุงูู</p>
          </div>

          {/* ๐ ุฒุฑ ุงูุจุฏุก */}
          <button
            onClick={onStart}
            className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-6 rounded-lg font-medium transition-colors"
          >
            ุงุจุฏุฃ ุงูุขู ุฅู ุดุงุก ุงููู
          </button>
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\LoginPage.js ---
// ===============================================
// ๐ ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู (Login Page)
// ุงูุฏุฎูู ุจุงูุงุณู ูุงุณู ุงูุฃู
// ===============================================

import { useState } from 'react';
import { LogIn, UserPlus } from 'lucide-react';
import IslamicBanner from '../shared/IslamicBanner';
import UniqueQuestionPicker from '../shared/UniqueQuestionPicker';

export default function LoginPage({ onLogin, onSwitchToRegister }) {
  const [formData, setFormData] = useState({ fullName: '', motherName: '' });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [showQuestionPicker, setShowQuestionPicker] = useState(false);
  const [selectedQuestion, setSelectedQuestion] = useState(null);
  const [questionAnswer, setQuestionAnswer] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    await handleLogin();
  };

  const handleLogin = async () => {
    setError('');
    setLoading(true);

    try {
      // Prepare login data
      const loginData = {
        fullName: formData.fullName,
        motherName: formData.motherName
      };

      // Add question data if it exists
      if (selectedQuestion && questionAnswer) {
        loginData.uniqueQuestion = selectedQuestion;
        loginData.questionAnswer = questionAnswer;
      }

      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(loginData)
      });

      const data = await res.json();

      if (!res.ok) {
        // 1. Check if multiple users exist
        if (data.requiresQuestion) {
          setShowQuestionPicker(true);
          setLoading(false);
          return;
        }

        setError(data.error || 'ุญุฏุซ ุฎุทุฃ');
        setLoading(false);
        return;
      }

      // 4. On success โ saveAuth() + navigate('home')
      onLogin(data.user, data.token);
    } catch (err) {
      setError('ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู');
      setLoading(false);
    }
  };

  const handleQuestionSubmit = (question, answer) => {
    setSelectedQuestion(question);
    setQuestionAnswer(answer);
    setShowQuestionPicker(false);
    // Continue login with question data
    handleLogin();
  };

  if (showQuestionPicker) {
    return (
      <UniqueQuestionPicker
        onSubmit={handleQuestionSubmit}
        onCancel={() => {
          setShowQuestionPicker(false);
          setLoading(false);
          setSelectedQuestion(null);
          setQuestionAnswer('');
        }}
      />
    );
  }

  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      {/* ๐ ุงูุจุงูุฑ */}
      <IslamicBanner />
      
      {/* ๐ ุงููุญุชูู */}
      <div className="flex-1 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-white rounded-lg shadow-sm border border-stone-200 p-8">
          
          {/* ๐จ ุงูุฃููููุฉ */}
          <div className="text-center mb-8">
            <div className="w-20 h-20 bg-emerald-600 rounded-full mx-auto flex items-center justify-center mb-4">
              <LogIn className="w-10 h-10 text-white" />
            </div>
            <h1 className="text-2xl font-semibold text-stone-800 mb-2">
              ุชุณุฌูู ุงูุฏุฎูู
            </h1>
            <p className="text-stone-700">
              ุฃุฏุฎู ุจูุงูุงุชู ูููุตูู ุฅูู ุญุณุงุจู
            </p>
          </div>

          {/* โ๏ธ ุฑุณุงูุฉ ุงูุฎุทุฃ */}
          {error && (
            <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4">
              {error}
            </div>
          )}

          {/* ๐ ุงููููุฐุฌ */}
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-stone-800 font-medium mb-2">
                ุงูุงุณู ุงููุงูู
              </label>
              <input
                type="text"
                value={formData.fullName}
                onChange={(e) => setFormData({...formData, fullName: e.target.value})}
                placeholder="ูุญูุฏ ุฃุญูุฏ ุงูุนูู"
                className="w-full px-4 py-3 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none text-base"
                required
              />
            </div>

            <div>
              <label className="block text-stone-800 font-medium mb-2">
                ุงุณู ุงูุฃู
              </label>
              <input
                type="text"
                value={formData.motherName}
                onChange={(e) => setFormData({...formData, motherName: e.target.value})}
                placeholder="ูุงุทูุฉ"
                className="w-full px-4 py-3 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none text-base"
                required
              />
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full bg-emerald-600 hover:bg-emerald-700 disabled:bg-stone-400 text-white py-3 rounded-lg font-medium transition-colors text-base"
            >
              {loading ? 'ุฌุงุฑู ุงูุฏุฎูู...' : 'ุฏุฎูู'}
            </button>
          </form>

          {/* ๐ ุฑุงุจุท ุงูุชุณุฌูู */}
          <div className="mt-6 pt-6 border-t border-stone-200 text-center">
            <p className="text-stone-700 mb-3">
              ููุณ ูุฏูู ุญุณุงุจุ
            </p>
            <button
              onClick={onSwitchToRegister}
              className="w-full flex items-center justify-center gap-2 bg-stone-100 hover:bg-stone-200 text-stone-800 py-3 rounded-lg font-medium transition-colors"
            >
              <UserPlus className="w-5 h-5" />
              ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\RegisterPage.js ---
'use client'
import { useState } from 'react';
import IslamicBanner from '../shared/IslamicBanner';
import UniqueQuestionPicker from '../shared/UniqueQuestionPicker';

const QUESTIONS = [
  'ูุง ุงุณู ูุงูุฏูุ',
  'ูุง ุงุณู ุฌุฏูุ',
  'ูุง ูููุชูุ',
  'ูุง ุงุณู ุฃุฎูู ุงูุฃูุจุฑุ',
  'ูู ุฃุฎ ูุฏููุ',
  'ูู ุฃุฎุช ูุฏููุ',
  'ูุง ูู ุนูููุ',
  'ูุง ูู ุดูุงุฏุชู ุงูุฏุฑุงุณูุฉุ',
  'ูุง ุงุณู ูุฏููุฉ ููุงุฏุชูุ',
  'ูุง ุงุณู ุฃูู ูุฏุฑุณุฉ ููุ',
  'ูุง ููู ุณูุงุฑุชู ุงูุฃูููุ',
  'ูุง ุงุณู ุญููุงูู ุงูุฃููู ุงูุฃููุ',
  'ูุง ุงุณู ุฃูุฑุจ ุตุฏูู ูู ูู ุงูุทูููุฉุ'
];

export default function RegisterPage({ onRegister, onSwitchToLogin }) {
  const [formData, setFormData] = useState({
    fullName: '',
    motherName: '',
    city: ''
  });
  const [loading, setLoading] = useState(false);
  const [showQuestions, setShowQuestions] = useState(false);
  const [selectedQuestion, setSelectedQuestion] = useState('');
  const [questionAnswer, setQuestionAnswer] = useState('');
  const [errorMessage, setErrorMessage] = useState('');

  const handleInitialSubmit = async (e) => {
    e.preventDefault();
    
    const fullName = formData.fullName.trim();
    const motherName = formData.motherName.trim();

    if (!fullName || !motherName) {
      alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณูู ูุงุณู ูุงูุฏุชู');
      return;
    }

    setLoading(true);
    setErrorMessage('');

    try {
      // ูุญุต ุงูุชูุฑุฏ
      const checkResponse = await fetch('/api/auth/check-uniqueness', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fullName, motherName })
      });

      const checkData = await checkResponse.json();

      if (checkData.isUnique) {
        // ุงูุงุณู ูุฑูุฏ - ุชุณุฌูู ูุจุงุดุฑ
        await registerUser();
      } else {
        // ุงูุงุณู ููุฑุฑ - ุนุฑุถ ุงูุฃุณุฆูุฉ
        setShowQuestions(true);
        setLoading(false);
      }
    } catch (error) {
      console.error('Error:', error);
      alert('ุฎุทุฃ ูู ุงูุงุชุตุงู');
      setLoading(false);
    }
  };

  const handleQuestionSubmit = async (e) => {
    e.preventDefault();

    if (!selectedQuestion || !questionAnswer.trim()) {
      alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุณุคุงู ูุฅุฏุฎุงู ุงูุฅุฌุงุจุฉ');
      return;
    }

    setLoading(true);
    setErrorMessage('');

    try {
      // ูุญุต ุชูุฑุฏ ุงูุณุคุงู ูุงูุฅุฌุงุจุฉ
      const checkResponse = await fetch('/api/auth/check-uniqueness', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          fullName: formData.fullName.trim(),
          motherName: formData.motherName.trim(),
          uniqueQuestion: selectedQuestion,
          questionAnswer: questionAnswer.trim()
        })
      });

      const checkData = await checkResponse.json();

      if (checkData.isUnique) {
        await registerUser();
      } else {
        setErrorMessage('ูุฐุง ุงูุณุคุงู ูุงูุฅุฌุงุจุฉ ูุณุชุฎุฏูุงู ุจุงููุนู. ุงุฎุชุฑ ุณุคุงูุงู ุขุฎุฑ ุฃู ุบููุฑ ุงูุฅุฌุงุจุฉ');
        setLoading(false);
      }
    } catch (error) {
      console.error('Error:', error);
      alert('ุฎุทุฃ ูู ุงูุงุชุตุงู');
      setLoading(false);
    }
  };

  const registerUser = async () => {
    try {
      const response = await fetch('/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          fullName: formData.fullName.trim(),
          motherName: formData.motherName.trim(),
          city: formData.city.trim(),
          showFullName: true,
          uniqueQuestion: selectedQuestion || null,
          questionAnswer: questionAnswer.trim() || null
        })
      });

      const data = await response.json();

      if (response.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));
        onRegister(data.user, data.token);
      } else {
        alert(data.error || 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู');
        setLoading(false);
      }
    } catch (error) {
      console.error('Error:', error);
      alert('ุฎุทุฃ ูู ุงูุงุชุตุงู');
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      <IslamicBanner />
      
      <div className="flex-1 flex items-center justify-center p-4">
        <div className="bg-white rounded-lg border border-stone-200 p-8 w-full max-w-md">
          <h2 className="text-2xl font-bold text-stone-800 mb-6 text-center">
            ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ
          </h2>

          {!showQuestions ? (
            <form onSubmit={handleInitialSubmit} className="space-y-4">
              <div>
                <label className="block text-stone-700 font-medium mb-2">
                  ุงุณูู
                </label>
                <input
                  type="text"
                  value={formData.fullName}
                  onChange={(e) => setFormData({...formData, fullName: e.target.value})}
                  placeholder="ูุซุงู: ุฃุญูุฏ"
                  className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
                  disabled={loading}
                />
              </div>

              <div>
                <label className="block text-stone-700 font-medium mb-2">
                  ุงุณู ูุงูุฏุชู
                </label>
                <input
                  type="text"
                  value={formData.motherName}
                  onChange={(e) => setFormData({...formData, motherName: e.target.value})}
                  placeholder="ูุซุงู: ูุงุทูุฉ"
                  className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
                  disabled={loading}
                />
              </div>

              <div>
                <label className="block text-stone-700 font-medium mb-2">
                  ูุฏููุชู (ุงุฎุชูุงุฑู)
                </label>
                <input
                  type="text"
                  value={formData.city}
                  onChange={(e) => setFormData({...formData, city: e.target.value})}
                  placeholder="ูุซุงู: ุงูุฑูุงุถ"
                  className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
                  disabled={loading}
                />
              </div>

              <button
                type="submit"
                disabled={loading}
                className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-lg font-semibold transition-colors disabled:opacity-50"
              >
                {loading ? 'ุฌุงุฑู ุงูุชุญูู...' : 'ูุชุงุจุนุฉ'}
              </button>
            </form>
          ) : (
            <form onSubmit={handleQuestionSubmit} className="space-y-4">
              <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4">
                <p className="text-sm text-stone-700 text-center">
                  โ๏ธ ููุงู ูุณุชุฎุฏู ุขุฎุฑ ุจููุณ ุงูุงุณู ูุงุณู ุงูุฃู
                  <br />
                  ุงุฎุชุฑ ุณุคุงูุงู ุณุฑูุงู ููุชูููุฒ
                </p>
              </div>

              {errorMessage && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                  <p className="text-sm text-red-700 text-center">{errorMessage}</p>
                </div>
              )}

              <div>
                <label className="block text-stone-700 font-medium mb-2">
                  ุงุฎุชุฑ ุณุคุงูุงู ุณุฑูุงู
                </label>
                <select
                  value={selectedQuestion}
                  onChange={(e) => {
                    setSelectedQuestion(e.target.value);
                    setErrorMessage('');
                  }}
                  className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
                  disabled={loading}
                >
                  <option value="">-- ุงุฎุชุฑ ุณุคุงูุงู --</option>
                  {QUESTIONS.map((q, idx) => (
                    <option key={idx} value={q}>{q}</option>
                  ))}
                </select>
              </div>

              {selectedQuestion && (
                <div>
                  <label className="block text-stone-700 font-medium mb-2">
                    ุงูุฅุฌุงุจุฉ
                  </label>
                  <input
                    type="text"
                    value={questionAnswer}
                    onChange={(e) => {
                      setQuestionAnswer(e.target.value);
                      setErrorMessage('');
                    }}
                    placeholder="ุฃุฏุฎู ุงูุฅุฌุงุจุฉ"
                    className="w-full px-4 py-2.5 border border-stone-300 rounded-lg focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 focus:outline-none"
                    disabled={loading}
                  />
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 rounded-lg font-semibold transition-colors disabled:opacity-50"
              >
                {loading ? 'ุฌุงุฑู ุงูุชุณุฌูู...' : 'ุชุณุฌูู'}
              </button>

              <button
                type="button"
                onClick={() => {
                  setShowQuestions(false);
                  setSelectedQuestion('');
                  setQuestionAnswer('');
                  setErrorMessage('');
                }}
                className="w-full text-stone-600 hover:text-stone-800 py-2"
              >
                โ ุฑุฌูุน
              </button>
            </form>
          )}

          <div className="mt-6 text-center">
            <button
              onClick={onSwitchToLogin}
              className="text-emerald-600 hover:text-emerald-700 font-medium"
            >
              ูุฏูู ุญุณุงุจุ ุชุณุฌูู ุฏุฎูู
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\pages\StatsPage.js ---
// ===============================================
// ๐ ุตูุญุฉ ุงูุฅุญุตุงุฆูุงุช (Stats Page)
// ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู ุงูุดุฎุตูุฉ
// ===============================================

import { useState, useEffect } from 'react';
import IslamicBanner from '../shared/IslamicBanner';
import MenuBar from '../shared/MenuBar';
import VerificationBadge from '../shared/VerificationBadge';

// ุชุญููู ุฃุณูุงุก ุงูููุฒุงุช ููุนุฑุจูุฉ
function getFeatureName(feature) {
  const featureNames = {
    'priority_display': 'ุธููุฑ ุจุงูุฃููููุฉ ูู ุงูููุงุฆู',
    'blue_badge': 'ุดุงุฑุฉ ุงูุชูุซูู ุงูุฒุฑูุงุก โ',
    'green_badge': 'ุดุงุฑุฉ ุงูุชูุซูู ุงูุฎุถุฑุงุก โโ',
    'gold_badge': 'ุดุงุฑุฉ ุงูุชูุซูู ุงูุฐูุจูุฉ ๐',
    'top_priority': 'ุฃููููุฉ ุนููุง',
    'max_priority': 'ุฃุนูู ุฃููููุฉ',
    'special_reactions': 'ุฑุฏูุฏ ูุนู ุฎุงุตุฉ'
  };
  return featureNames[feature] || feature;
}

export default function StatsPage({ user, onNavigate, onEditProfile, onLogout }) {
  // ๐ ุญุงูุฉ ุงูุชูุซูู
  const [verificationData, setVerificationData] = useState(null);
  const [loading, setLoading] = useState(true);

  // ุฌูุจ ุจูุงูุงุช ุงูุชูุซูู ูู API
  useEffect(() => {
    if (user) {
      const token = localStorage.getItem('token');
      if (!token) {
        setLoading(false);
        return;
      }

      fetch('/api/users/stats', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            setVerificationData(data.stats);
          }
          setLoading(false);
        })
        .catch(err => {
          console.error('Error fetching stats:', err);
          setLoading(false);
        });
    }
  }, [user]);

  if (loading) {
    return (
      <div className="min-h-screen bg-stone-50 flex items-center justify-center">
        <p className="text-stone-600">ุฌุงุฑู ุงูุชุญููู...</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-stone-50 flex flex-col">
      {/* ๐ ุงูุจุงูุฑ */}
      <IslamicBanner />

      {/* ๐ฑ ุงููุงุฆูุฉ */}
      <MenuBar
        user={user}
        currentPage="stats"
        onNavigate={onNavigate}
        onEditProfile={onEditProfile}
        onLogout={onLogout}
      />

      {/* ๐ ุงููุญุชูู */}
      <div className="flex-1 p-4">
        <div className="max-w-2xl mx-auto space-y-4">

          {/* ๐ฏ ุฏุนูุงุช ูุฐุง ุงูุดูุฑ */}
          <div className="bg-white rounded-lg border border-stone-200 p-6 text-center">
            <div className="text-5xl font-bold text-emerald-600 mb-2">
              {verificationData?.prayersThisMonth || 0}
            </div>
            <p className="text-stone-600">ุฏุนุงุก ูุฐุง ุงูุดูุฑ</p>
            <p className="text-sm text-emerald-600 mt-2">ูุงุดุงุก ุงููู ุชุจุงุฑู ุงููู</p>
          </div>

          {/* ๐ ุญุงูุฉ ุงูุชูุซูู */}
          {verificationData && (
            <div className="bg-white p-6 rounded-lg border border-stone-200">
              <h3 className="text-lg font-bold text-stone-800 mb-4">
                ุญุงูุฉ ุงูุชูุซูู
              </h3>

              <div className="text-center mb-4">
                <VerificationBadge
                  level={verificationData.verificationLevel}
                  size="lg"
                />
                <p className="text-2xl font-bold text-emerald-600 mt-2">
                  {verificationData.interactionRate}%
                </p>
                <p className="text-sm text-stone-600">ูุนุฏู ุงูุชูุงุนู</p>
              </div>

              {verificationData.nextLevel?.level !== 'MAX' && (
                <div className="bg-amber-50 p-4 rounded-lg border border-amber-200 mb-4">
                  <p className="text-sm text-stone-700 text-center">
                    ุจุงูู <span className="font-bold text-amber-600">{verificationData.nextLevel.remaining}%</span>
                    {' '}ูููุตูู ุฅูู <span className="font-bold">{verificationData.nextLevel.levelName}</span>
                    {' '}{verificationData.nextLevel.icon}
                  </p>
                </div>
              )}

              {verificationData.unlockedFeatures && verificationData.unlockedFeatures.length > 0 && (
                <div className="mt-6">
                  <h4 className="font-semibold text-stone-800 mb-3">ุงููููุฒุงุช ุงูููุชูุญุฉ:</h4>
                  <ul className="space-y-2">
                    {verificationData.unlockedFeatures.map(feature => (
                      <li key={feature} className="text-emerald-600 flex items-center gap-2 text-sm">
                        <span className="text-emerald-600">โ</span>
                        <span>{getFeatureName(feature)}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              {(!verificationData.unlockedFeatures || verificationData.unlockedFeatures.length === 0) && (
                <div className="mt-6 text-center">
                  <p className="text-stone-600 text-sm">
                    ุงุณุชูุฑ ูู ุงูุฏุนุงุก ููุขุฎุฑูู ููุชุญ ุงููููุฒุงุช! ๐ช
                  </p>
                </div>
              )}
            </div>
          )}

          {/* ๐ ุฅุญุตุงุฆูุงุช ุนุงูุฉ */}
          <div className="bg-white rounded-lg border border-stone-200 p-6">
            <h3 className="font-semibold text-stone-800 mb-4">ุฅุญุตุงุฆูุงุช ุนุงูุฉ</h3>
            <div className="space-y-3">

              <div className="flex justify-between items-center p-3 bg-stone-50 rounded-lg">
                <span className="text-stone-600">ุฅุฌูุงูู ุฏุนูุงุชู</span>
                <span className="font-semibold text-emerald-600">
                  {verificationData?.totalPrayersGiven || 0}
                </span>
              </div>

              <div className="flex justify-between items-center p-3 bg-stone-50 rounded-lg">
                <span className="text-stone-600">ุฏุนุง ูู</span>
                <span className="font-semibold text-emerald-600">
                  {verificationData?.prayersReceivedCount || 0} ูุคูู
                </span>
              </div>

              <div className="flex justify-between items-center p-3 bg-stone-50 rounded-lg">
                <span className="text-stone-600">ุทูุจุงุช ุงุณุชูุฌูุจุช</span>
                <span className="font-semibold text-amber-600">
                  {verificationData?.answeredPrayers || 0}
                </span>
              </div>

              <div className="flex justify-between items-center p-3 bg-stone-50 rounded-lg">
                <span className="text-stone-600">ุฅุดุนุงุฑุงุช ุงุณุชููุชูุง</span>
                <span className="font-semibold text-blue-600">
                  {verificationData?.totalNotificationsReceived || 0}
                </span>
              </div>
            </div>
          </div>

          {/* ๐ ุงูุฃุซุฑ */}
          <div className="bg-gradient-to-br from-emerald-50 to-amber-50 rounded-lg border border-emerald-200 p-6">
            <h3 className="font-semibold text-stone-800 mb-3 text-center">
              ุฃุซุฑู ูู ุงูููุตุฉ
            </h3>
            <p className="text-sm text-stone-600 text-center mb-4">
              ุฏุนูุงุชู ุณุงููุช ูู ุฑุงุญุฉ {verificationData?.totalPrayersGiven || 0} ููุจ ุฅู ุดุงุก ุงููู
            </p>
            <div className="text-center text-3xl">๐</div>
          </div>
        </div>
      </div>
    </div>
  );
}

=== ALL SHARED COMPONENTS ===

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\CountdownTimer.js ---
// Props: {targetTimestamp, onComplete, label}

// State: timeRemaining (seconds)

// useEffect: setInterval every 1s
// Calculate: hours, minutes, seconds from timeRemaining

// UI:
// <div className="text-center">
//   <p className="text-lg font-semibold text-stone-700">{label}</p>
//   <div className="text-3xl font-bold text-emerald-600">
//     {hours}:{minutes}:{seconds}
//   </div>
// </div>

// When reaches 0 โ call onComplete()

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\InstallPrompt.js ---
'use client'
import { useState, useEffect } from 'react';

export default function InstallPrompt() {
  const [showPrompt, setShowPrompt] = useState(false);
  const [deferredPrompt, setDeferredPrompt] = useState(null);

  useEffect(() => {
    const handler = (e) => {
      e.preventDefault();
      setDeferredPrompt(e);
      setShowPrompt(true);
    };

    window.addEventListener('beforeinstallprompt', handler);
    return () => window.removeEventListener('beforeinstallprompt', handler);
  }, []);

  const handleInstall = async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    setDeferredPrompt(null);
    setShowPrompt(false);
  };

  if (!showPrompt) return null;

  return (
    <div className="fixed bottom-20 left-4 right-4 bg-emerald-600 text-white p-4 rounded-lg shadow-lg z-50">
      <p className="font-semibold mb-2">ุซุจูุช ุงูุชุทุจูู ุนูู ุฌูุงุฒู</p>
      <div className="flex gap-2">
        <button onClick={handleInstall} className="flex-1 bg-white text-emerald-600 py-2 rounded-lg font-semibold">
          ุชุซุจูุช
        </button>
        <button onClick={() => setShowPrompt(false)} className="px-4 bg-emerald-700 rounded-lg">
          ูุงุญูุงู
        </button>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\IslamicBanner.js ---
// ===============================================
// ๐ ุงูุจุงูุฑ ุงูุฅุณูุงูู ุงูุนููู
// ูุธูุฑ ูู ุฃุนูู ูู ุตูุญุฉ ููุณุงุญุฉ ุฅุนูุงููุฉ
// ===============================================

import { useState, useEffect } from 'react';

export default function IslamicBanner() {
  const [bannerData, setBannerData] = useState(null);

  useEffect(() => {
    fetch('/api/settings/banner')
      .then(res => res.json())
      .then(data => setBannerData(data))
      .catch(err => console.error('Error fetching banner:', err));
  }, []);

  return (
    <div className="h-20 bg-gradient-to-r from-emerald-700 via-emerald-600 to-emerald-700 relative overflow-hidden">
      {/* ๐จ ุงูุฒุฎุฑูุฉ ุงูุฎูููุฉ */}
      <div className="absolute inset-0 opacity-20">
        <div 
          className="h-full w-full" 
          style={{
            backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px)`,
          }}
        ></div>
      </div>
      
      {/* ๐ ุงููุญุชูู - Logo "ููุฌูุจ" */}
      <div className="absolute inset-0 flex items-center justify-center">
        <div className="text-center">
          <div className="logo-text mb-1">ููุฌูุจ</div>
          {bannerData?.active && (
            <div className="text-amber-200 text-xs opacity-75">
              {bannerData.text}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\MenuBar.js ---
// ===============================================
// ๐ฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (Header + Menu)
// ุชุธูุฑ ูู ุฃุนูู ุงูุตูุญุงุช ุงูุฏุงุฎููุฉ
// ===============================================

import { useState } from 'react';
import { Menu, Edit2, Users, TrendingUp, Award, Heart, HelpCircle } from 'lucide-react';

export default function MenuBar({ user, currentPage, onNavigate, onEditProfile }) {
  const [showMenu, setShowMenu] = useState(false);

  // ๐ ุนูุงุตุฑ ุงููุงุฆูุฉ
  const menuItems = [
    { id: 'home', label: 'ุงูุฑุฆูุณูุฉ', icon: Users },
    { id: 'stats', label: 'ุงูุฅุญุตุงุฆูุงุช', icon: TrendingUp },
    { id: 'achievements', label: 'ุงูุฅูุฌุงุฒุงุช', icon: Award },
    { id: 'about', label: 'ูู ูุญู', icon: Heart },
    { id: 'faq', label: 'ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ', icon: HelpCircle },
  ];

  const handleMenuClick = (pageId) => {
    onNavigate(pageId);
    setShowMenu(false);
  };

  return (
    <>
      {/* ๐ฏ ุงูููุฏุฑ ุงูุซุงุจุช */}
      <div className="bg-white border-b border-stone-200 sticky top-0 z-10">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            {/* ุฒุฑ ุงููุงุฆูุฉ */}
            <button
              onClick={() => setShowMenu(!showMenu)}
              className="text-stone-600 hover:text-emerald-600 transition-colors"
            >
              <Menu className="w-6 h-6" />
            </button>

            {/* ุงูุนููุงู */}
            <div className="text-center">
              <h1 className="text-lg font-semibold text-stone-800">
                ููุตุฉ ุงูุฏุนุงุก ุงูุฌูุงุนู
              </h1>
              <p className="text-xs text-stone-600">
                ูุฑุญุจุงู {user?.displayName}
              </p>
            </div>

            {/* ุฒุฑ ุชุนุฏูู ุงูููู ุงูุดุฎุตู */}
            <button
              onClick={onEditProfile}
              className="text-stone-600 hover:text-emerald-600 transition-colors"
            >
              <Edit2 className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* ๐ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ */}
        {showMenu && (
          <div className="absolute top-full left-0 right-0 bg-white border-b border-stone-200 shadow-lg">
            <div className="max-w-2xl mx-auto">
              {menuItems.map((item) => {
                const Icon = item.icon;
                return (
                  <button
                    key={item.id}
                    onClick={() => handleMenuClick(item.id)}
                    className={`w-full px-4 py-3 text-right hover:bg-stone-50 transition-colors border-b border-stone-100 flex items-center gap-3 ${
                      currentPage === item.id ? 'bg-emerald-50' : ''
                    }`}
                  >
                    <Icon className="w-5 h-5 text-emerald-600" />
                    <span className="text-stone-700">{item.label}</span>
                  </button>
                );
              })}
            </div>
          </div>
        )}
      </div>
    </>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\PrayerCard.js ---

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\ReactionButtons.js ---
// ===============================================
// ๐ฌ ุฃุฒุฑุงุฑ ุงูุชูุงุนู (Reaction Buttons)
// ุชุธูุฑ ุนูู ุทูุจุงุช ุงูุฏุนุงุก ูุตุงุญุจ ุงูุทูุจ
// ===============================================

export default function ReactionButtons({ requestId, currentUserReaction, onReact }) {
  const reactions = {
    heart: 12,
    angel: 8,
    like: 15
  };

  return (
    <div className="flex gap-3 justify-center">
      <button
        onClick={() => onReact('heart')}
        className={`flex items-center gap-1 px-4 py-2 rounded-full transition-all ${
          currentUserReaction === 'heart' 
            ? 'bg-red-100 scale-110' 
            : 'bg-stone-100 hover:bg-red-50'
        }`}
      >
        โค๏ธ <span className="text-sm">{reactions.heart}</span>
      </button>

      <button
        onClick={() => onReact('angel')}
        className={`flex items-center gap-1 px-4 py-2 rounded-full transition-all ${
          currentUserReaction === 'angel'
            ? 'bg-amber-100 scale-110'
            : 'bg-stone-100 hover:bg-amber-50'
        }`}
      >
        ๐ <span className="text-sm">{reactions.angel}</span>
      </button>

      <button
        onClick={() => onReact('like')}
        className={`flex items-center gap-1 px-4 py-2 rounded-full transition-all ${
          currentUserReaction === 'like'
            ? 'bg-emerald-100 scale-110'
            : 'bg-stone-100 hover:bg-emerald-50'
        }`}
      >
        ๐ <span className="text-sm">{reactions.like}</span>
      </button>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\ReviewPrompt.js ---
// Google review prompt (shown after 20 prayers)

const [showReview, setShowReview] = useState(false)

useEffect(() => {
  if (user && stats.totalPrayersGiven >= 20) {
    fetch('/api/reviews/request', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${getAuth().token}`
      },
      body: JSON.stringify({userId: user.id})
    })
    .then(res => res.json())
    .then(data => {
      if (data.shouldAskReview) {
        setShowReview(true)
      }
    })
  }
}, [user, stats])

// UI: Modal
{showReview && (
  <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div className="bg-white rounded-lg p-6 max-w-sm">
      <div className="text-4xl text-center mb-4">โญ</div>
      <h3 className="text-lg font-bold text-center mb-3">
        ูู ุฃุนุฌุจุชู ุงูููุตุฉุ
      </h3>
      <p className="text-sm text-stone-600 text-center mb-4">
        ุณุงุนุฏูุง ุจุชููููู ุนูู Google ููุตู ููุฒูุฏ ูู ุงููุคูููู
      </p>
      
      <div className="flex gap-3">
        <a 
          href="https://g.page/r/..." 
          target="_blank"
          className="flex-1 bg-emerald-600 text-white py-2 rounded text-center"
          onClick={() => setShowReview(false)}
        >
          ุชูููู ุงูุขู
        </a>
        <button 
          onClick={() => setShowReview(false)}
          className="px-4 text-stone-600"
        >
          ูุงุญูุงู
        </button>
      </div>
    </div>
  </div>
)}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\ShareButton.js ---
'use client'
import { Share2 } from 'lucide-react';

export default function ShareButton({ title, text, url }) {
  const handleShare = async () => {
    if (navigator.share) {
      try {
        await navigator.share({ title, text, url });
      } catch (err) {
        console.error('Share failed:', err);
      }
    } else {
      navigator.clipboard.writeText(url);
      alert('ุชู ูุณุฎ ุงูุฑุงุจุท!');
    }
  };

  return (
    <button
      onClick={handleShare}
      className="w-full bg-sky-600 hover:bg-sky-700 text-white p-5 rounded-lg transition-colors flex items-center justify-center gap-3"
    >
      <Share2 className="w-5 h-5" />
      <div className="text-center">
        <p className="font-semibold">ุดุงุฑู ุงููููุน</p>
        <p className="text-sm opacity-90">ูู ูุคูู ุฌุฏูุฏ ูุนูู ุฏุนูุงุช ุฃูุซุฑ ุฅู ุดุงุก ุงููู</p>
      </div>
    </button>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\TopWeeklyUser.js ---
'use client'

export default function TopWeeklyUser({ topUser }) {
  if (!topUser) return null;

  return (
    <div className="bg-gradient-to-r from-amber-500 to-amber-600 rounded-lg p-6 text-white">
      <div className="text-center">
        <div className="text-4xl mb-2">๐</div>
        <h3 className="text-lg font-bold mb-1">ุฃูุถู ูุณุชุฎุฏู ูุฐุง ุงูุฃุณุจูุน</h3>
        <p className="text-2xl font-bold mb-1">{topUser.displayName}</p>
        <p className="text-sm opacity-90">{topUser.prayerCount} ุฏุนุงุก</p>
      </div>
    </div>
  );
}

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\UniqueQuestionPicker.js ---
// Props: {onSelectQuestion, onAnswerSubmit, availableQuestions}

// QUESTIONS array:
const UNIQUE_QUESTIONS = [
  {id: 'father', label: 'ุงุณู ูุงูุฏู', placeholder: 'ุฃุญูุฏ'},
  {id: 'grandfather', label: 'ุงุณู ุฌุฏู ูุฃุจ', placeholder: 'ูุญูุฏ'},
  {id: 'nickname', label: 'ูููุชู', placeholder: 'ุฃุจู ุนุจุฏุงููู'},
  {id: 'birthDay', label: 'ููู ูููุงุฏู', type: 'number'},
  {id: 'country', label: 'ุจูุฏู', placeholder: 'ูุตุฑ'},
  {id: 'region', label: 'ููุทูุชู', placeholder: 'ุงููุนุงุฏู'},
  {id: 'firstSchool', label: 'ุฃูู ูุฏุฑุณุฉ', placeholder: 'ูุฏุฑุณุฉ ุงูููุฑ'},
  {id: 'motherCity', label: 'ูุฏููุฉ ูููุงุฏ ูุงูุฏุชู', placeholder: 'ุงูุฅุณููุฏุฑูุฉ'}
]

// UI: Dropdown to select question โ Input field โ Submit button
// Font-size: text-base โ text-lg
// Colors: stone-700, emerald-600

--- FILE: C:\Users\hayda\OneDrive\Desktop\ALGHAFIQI\dua-platform\dua-platform\components\shared\VerificationBadge.js ---
'use client'

export default function VerificationBadge({ level, size = 'md', showTooltip = true }) {
  if (!level) return null;

  const sizeClasses = {
    sm: 'text-base',
    md: 'text-lg', 
    lg: 'text-2xl'
  };

  return (
    <span className={sizeClasses[size]} title={showTooltip ? level.name : ''}>
      {level.icon}
    </span>
  );
}

=== DATABASE SCHEMA ===
import { Pool } from 'pg';

// ุฅูุดุงุก pool ููุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,
  max: 20, // ุงูุญุฏ ุงูุฃูุตู ููุงุชุตุงูุงุช
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});

// ุงูุชุญูู ูู ุงูุงุชุตุงู
pool.on('connect', () => {
  console.log('โ Connected to PostgreSQL database');
});

pool.on('error', (err) => {
  console.error('โ Unexpected error on idle client', err);
  process.exit(-1);
});

// ุฏุงูุฉ ููุงุณุชุนูุงูุงุช
export const query = async (text, params) => {
  const start = Date.now();
  try {
    const res = await pool.query(text, params);
    const duration = Date.now() - start;
    console.log('Executed query', { text, duration, rows: res.rowCount });
    return res;
  } catch (error) {
    console.error('Database query error:', error);
    throw error;
  }
};

// ุฏุงูุฉ ููุญุตูู ุนูู client ูู pool (ูููุนุงููุงุช)
export const getClient = async () => {
  const client = await pool.connect();
  const query = client.query.bind(client);
  const release = client.release.bind(client);

  // ุชุนููู timeout
  const timeout = setTimeout(() => {
    console.error('A client has been checked out for more than 5 seconds!');
  }, 5000);

  // ุชุนุฏูู release ูุฅุฒุงูุฉ timeout
  client.release = () => {
    clearTimeout(timeout);
    return release();
  };

  return client;
};

export default pool;
